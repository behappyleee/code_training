<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ðŸ‘€</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://fav.farm/ðŸ”¥" />
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>

<script>
  const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
  const http = new XMLHttpRequest();
  let cityData = new Array();

  http.open("GET", endpoint); // GET ìœ¼ë¡œ ë°ì´í„° ë°›ì„ ì£¼ì†Œ ì§€ì •
  http.send();  // request í•¨
  
  http.onreadystatechange = function () {
    if(http.readyState == XMLHttpRequest.DONE) { // request ê°€ ì™„ë£Œ ëì„ ë•Œ
      if(http.status == 200){ // ì„±ê³µ
          cityData = Array.from(JSON.parse(http.responseText));
          } else  {   // ì‹¤íŒ¨
            alert('DATA ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤ !');
            console.log('HTTP STATUS FAIL DATA : ' + JSON.stringify(http));
        }
    }
  }

  const inputSearch = document.querySelector('.search');

  // í•¨ìˆ˜ ì„ ì–¸ì‹ì€ í˜¸ì´ìŠ¤íŒ… ì•ˆë˜ë¯€ë¡œ ì‚¬ìš© í•˜ëŠ” ê³³ë³´ë‹¤ ë¬´ì¡°ê±´ ì•žì— ì„ ì–¸
  const filterInputCity = (e) => {
    let inputCityValue = e.target.value;
    if(!cityData) {
      alert('ìž ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš” !');
    }

    let filteredCityData = cityData.filter((city) => {
      let cityName = city.city;
      let cityState = city.state;
      return (cityName.startsWith(inputCityValue) || cityState.startsWith(inputCityValue));
    }); 
    showDataArray(filteredCityData);
  }

  const showDataArray = (arrayData) => {
    let suggestionSelector = document.querySelector('.suggestions');
    let arrayHtmlData = makeArrayHtml(arrayData);

    console.log('TYPE OF SUGGENSTIONS QUERY SELECTOR TYPE : ' + suggestionSelector);

    suggestionSelector.innerHTML = arrayHtmlData;
  }

  const makeArrayHtml = (arrayHtml) => {
    let innerHtml = '';
    arrayHtml.map((eachArrayData) => {
      innerHtml += '<li>';
      innerHtml +=  eachArrayData.city + ',' + eachArrayData.state + eachArrayData.population;
      innerHtml += '</li>';  
    })
    return innerHtml;
  }

  inputSearch.addEventListener('input', filterInputCity);

  console.log('end point data : ' + JSON.stringify(endpoint));

</script>
</body>
</html>
